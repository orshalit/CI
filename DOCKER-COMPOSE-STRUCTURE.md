# Docker Compose File Structure

## âœ… Current Structure (Final)

```
CI/
â”œâ”€â”€ docker-compose.base.yml              # âœ… Shared infrastructure (database, etc.)
â”œâ”€â”€ docker-compose.yml.disabled          # ğŸ“‹ Legacy reference (DO NOT USE)
â”œâ”€â”€ docker-compose.prod.yml.disabled     # ğŸ“‹ Legacy reference (DO NOT USE)
â””â”€â”€ applications/
    â”œâ”€â”€ README.md                        # âœ… Usage guide
    â”œâ”€â”€ .docker-compose.template.yml     # âœ… Template showing structure
    â””â”€â”€ {app-name}/
        â”œâ”€â”€ docker-compose.yml           # âœ… App-specific (self-contained)
        â””â”€â”€ docker-compose.prod.yml      # âœ… Production overrides (optional)
```

## File Purposes

### âœ… Active Files

1. **`docker-compose.base.yml`** (Root)
   - Shared infrastructure services
   - Database, Redis, Message Queues
   - Networks and Volumes
   - **KEEP** - Used by all applications

2. **`applications/{app-name}/docker-compose.yml`** (Per-App)
   - Application-specific services
   - Backend and Frontend services
   - Auto-generated by script
   - **KEEP** - Self-contained with app code

3. **`applications/{app-name}/docker-compose.prod.yml`** (Optional)
   - Production overrides
   - Uses images from registry
   - **KEEP** - Generated with `--prod` flag

### ğŸ“‹ Reference/Template Files

4. **`docker-compose.yml.disabled`** (Root)
   - Legacy all-in-one file (reference only)
   - Shows migration path
   - **DO NOT USE** - Keep for reference

5. **`docker-compose.prod.yml.disabled`** (Root)
   - Legacy production all-in-one (reference only)
   - Shows migration path
   - **DO NOT USE** - Keep for reference

6. **`applications/.docker-compose.template.yml`**
   - Template showing structure
   - Usage instructions
   - **REFERENCE** - Shows what gets generated

## âŒ Removed Files

- ~~`docker-compose.yml`~~ â†’ Moved to `.disabled`
- ~~`docker-compose.prod.yml`~~ â†’ Moved to `.disabled`
- ~~`docker-compose.test-app.yml`~~ â†’ Moved to `applications/test-app/docker-compose.yml`

## Usage

### Generate Compose Files

```bash
# Generate for specific app
./scripts/generate-app-compose.sh <app-name>

# Generate for all apps
./scripts/generate-app-compose.sh

# Generate production overrides
./scripts/generate-app-compose.sh <app-name> --prod
```

### Run Applications

```bash
# Single app (from root)
docker compose -f docker-compose.base.yml \
               -f applications/test-app/docker-compose.yml up

# Single app (from app directory)
cd applications/test-app
docker compose -f ../../docker-compose.base.yml \
               -f docker-compose.yml up

# All apps (CI/CD)
docker compose -f docker-compose.base.yml \
               -f applications/*/docker-compose.yml up
```

## Summary

- âœ… **Keep**: `docker-compose.base.yml` (shared infrastructure)
- âœ… **Keep**: `applications/{app}/docker-compose.yml` (per-app, self-contained)
- âœ… **Keep**: `.disabled` files (reference/templates)
- âŒ **Removed**: All root-level app-specific compose files

Everything is now self-contained and follows best practices!

